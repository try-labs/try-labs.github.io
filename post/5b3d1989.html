<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>è§£è€¦ç¥å™¨ä¹‹è§‚å¯Ÿè€…æ¨¡å¼ | Samçš„ä¸ªäººåšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="å¤§å®¶æ˜¯ä¸æ˜¯ä¼šç»å¸¸å¬åˆ°æœ‰äººè¯´å†™ä»£ç è¦â€œé«˜å†…èšã€ä½è€¦åˆâ€ï¼Œä½†æ˜¯ä½ è¦æ˜¯é—®ä»–ä»€ä¹ˆæ˜¯é«˜å†…èšä½è€¦åˆï¼ˆwahtï¼‰ï¼Ÿä¸ºä»€ä¹ˆè¦é«˜å†…èšã€ä½è€¦åˆ(why)ï¼Ÿæ€ä¹ˆåšæ‰èƒ½é«˜å†…èšã€ä½è€¦åˆ(how)? è¿™äº›é—®é¢˜å°±ä¸ä¸€å®šéƒ½èƒ½å›ç­”çš„äº†ï¼">
<meta property="og:type" content="article">
<meta property="og:title" content="è§£è€¦ç¥å™¨ä¹‹è§‚å¯Ÿè€…æ¨¡å¼">
<meta property="og:url" content="https://ydstudios.gitee.io/post/5b3d1989.html">
<meta property="og:site_name" content="Samçš„ä¸ªäººåšå®¢">
<meta property="og:description" content="å¤§å®¶æ˜¯ä¸æ˜¯ä¼šç»å¸¸å¬åˆ°æœ‰äººè¯´å†™ä»£ç è¦â€œé«˜å†…èšã€ä½è€¦åˆâ€ï¼Œä½†æ˜¯ä½ è¦æ˜¯é—®ä»–ä»€ä¹ˆæ˜¯é«˜å†…èšä½è€¦åˆï¼ˆwahtï¼‰ï¼Ÿä¸ºä»€ä¹ˆè¦é«˜å†…èšã€ä½è€¦åˆ(why)ï¼Ÿæ€ä¹ˆåšæ‰èƒ½é«˜å†…èšã€ä½è€¦åˆ(how)? è¿™äº›é—®é¢˜å°±ä¸ä¸€å®šéƒ½èƒ½å›ç­”çš„äº†ï¼">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210206152451.png">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230758.png">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230024.png">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204225825.png">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204214744.png">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204222111.png">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230251.png">
<meta property="og:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230429.png">
<meta property="article:published_time" content="2021-02-04T23:49:32.000Z">
<meta property="article:modified_time" content="2021-02-06T09:07:26.000Z">
<meta property="article:author" content="Sam">
<meta property="article:tag" content="è®¾è®¡æ¨¡å¼">
<meta property="article:tag" content="spring">
<meta property="article:tag" content="è§‚å¯Ÿè€…æ¨¡å¼">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/ydstudios/blogImage/raw/master/img/20210206152451.png">
  
    <link rel="alternate" href="/atom.xml" title="Samçš„ä¸ªäººåšå®¢" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Samçš„ä¸ªäººåšå®¢</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">ä¸€ä¸ªç¨‹åºå‘˜çš„æˆé•¿è®°å½•</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">é¦–é¡µ</a>
        
          <a class="main-nav-link" href="/archives">å½’æ¡£</a>
        
          <a class="main-nav-link" href="/about">å…³äº</a>
        
          <a class="main-nav-link" href="/links">å‹é“¾</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://ydstudios.gitee.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-è§£è€¦ç¥å™¨ä¹‹è§‚å¯Ÿè€…æ¨¡å¼" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/post/5b3d1989.html" class="article-date">
  <time datetime="2021-02-04T23:49:32.000Z" itemprop="datePublished">2021-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      è§£è€¦ç¥å™¨ä¹‹è§‚å¯Ÿè€…æ¨¡å¼
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>å¤§å®¶æ˜¯ä¸æ˜¯ä¼šç»å¸¸å¬åˆ°æœ‰äººè¯´å†™ä»£ç è¦â€œé«˜å†…èšã€ä½è€¦åˆâ€ï¼Œä½†æ˜¯ä½ è¦æ˜¯é—®ä»–ä»€ä¹ˆæ˜¯é«˜å†…èšä½è€¦åˆï¼ˆwahtï¼‰ï¼Ÿä¸ºä»€ä¹ˆè¦é«˜å†…èšã€ä½è€¦åˆ(why)ï¼Ÿæ€ä¹ˆåšæ‰èƒ½é«˜å†…èšã€ä½è€¦åˆ(how)? è¿™äº›é—®é¢˜å°±ä¸ä¸€å®šéƒ½èƒ½å›ç­”çš„äº†ï¼</p>
<a id="more"></a>

<blockquote>
<p>ç™¾åº¦ç™¾ç§‘ï¼šåœ¨è½¯ä»¶è®¾è®¡ä¸­é€šå¸¸ç”¨è€¦åˆåº¦å’Œå†…èšåº¦ä½œä¸ºè¡¡é‡æ¨¡å—ç‹¬ç«‹ç¨‹åº¦çš„æ ‡å‡†ã€‚åˆ’åˆ†æ¨¡å—çš„ä¸€ä¸ªå‡†åˆ™æ˜¯é«˜å†…èšä½è€¦åˆã€‚<br>ä»æ¨¡å—ç²’åº¦æ¥çœ‹ï¼Œé«˜å†…èšï¼šå°½å¯èƒ½ç±»çš„æ¯ä¸ªæˆå‘˜æ–¹æ³•åªå®Œæˆä¸€ä»¶äº‹ï¼ˆæœ€å¤§é™åº¦çš„èšåˆï¼‰ï¼› ä½è€¦åˆï¼šå‡å°‘ç±»å†…éƒ¨ï¼Œä¸€ä¸ªæˆå‘˜æ–¹æ³•è°ƒç”¨å¦ä¸€ä¸ªæˆå‘˜æ–¹æ³•ã€‚<br>ä»ç±»è§’åº¦æ¥çœ‹ï¼Œ é«˜å†…èšä½è€¦åˆï¼šå‡å°‘ç±»å†…éƒ¨ï¼Œå¯¹å…¶ä»–ç±»çš„è°ƒç”¨ï¼›<br>ä»åŠŸèƒ½å—æ¥çœ‹ï¼Œé«˜å†…èšä½è€¦åˆï¼šå‡å°‘æ¨¡å—ä¹‹é—´çš„äº¤äº’å¤æ‚åº¦ï¼ˆæ¥å£æ•°é‡ï¼Œå‚æ•°æ•°æ®ï¼‰å³æ¨ªå‘ï¼šç±»ä¸ç±»ä¹‹é—´ã€æ¨¡å—ä¸æ¨¡å—ä¹‹é—´ï¼›çºµå‘ï¼šå±‚æ¬¡ä¹‹é—´ï¼›å°½å¯èƒ½ï¼Œå†…å®¹å†…èšï¼Œæ•°æ®è€¦åˆã€‚</p>
</blockquote>
<p>æˆ‘æœ¬äººç‰¹åˆ«å–œæ¬¢æè¿æ°æ¼”çš„è¿™ä¸€ç‰ˆéœå…ƒç”²ï¼Œä»–å¹´å°‘è½»ç‹‚ï¼Œå¥½å‹‡æ–—ç‹ ï¼Œå‹‡äº‰æ´¥é—¨ç¬¬ä¸€ï¼Œä¸­å¹´å®¶ç ´äººäº¡ï¼Œæµè½ä»–ä¹¡æ‚Ÿå‡ºäº†ä¾ çš„çœŸè°›ï¼Œæˆä¸ºçœŸæ­£çš„å¤§ä¾ éœå…ƒç”²ã€‚å½“ç„¶æˆ‘ä¸å¤ªå¸Œæœ›æˆ‘çš„ä¸€ç”Ÿè¿™ä¹ˆæ³¢è¡èµ·ä¼ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰ä»–é‚£ä¹ˆå‰å®³ã€‚ä½†æ˜¯æˆ‘ç‰¹åˆ«å–œæ¬¢å‰§ä¸­çš„ä¸€å¥å°è¯ï¼Œå°±æ˜¯â€œ<strong>åŠŸå¤«æ˜¯éœ€è¦æ—¶é—´å»ç£¨ç»ƒå‡ºæ¥çš„ï¼Œä¸¤ä¸‰å¹´çš„çŒ«è„šåŠŸå¤«ï¼Œè¿™ä¸€æ‹³20å¹´çš„åŠŸå¤«ï¼Œä½ ä»¬æŒ¡å¾—ä½ä¹ˆï¼Ÿ</strong>ã€‚ä½œä¸ºä¸€ä½ç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å¯¹ä¸šåŠ¡çš„ç†è§£ã€ç³»ç»Ÿçš„è®¾è®¡ã€ä»£ç å®ç°è¿™äº›èƒ½åŠ›ä¹Ÿæ˜¯éœ€è¦ç£¨ç»ƒçš„ï¼Œè€Œä¸”ä¹Ÿè¦æ—¥å¤ä¸€æ—¥çš„ç»ƒä¹ ï¼Œä¸ç„¶ä½ æ€ä¹ˆæŒ¡å¾—ä½é¢è¯•å®˜20å¹´çš„åŠŸå¤«ã€‚ğŸ˜„ğŸ˜„</p>
<img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210206152451.png" alt="éœå…ƒç”²" style="zoom:30%;" />


<p>æœ¬æ–‡å¯¹äºä»€ä¹ˆæ˜¯é«˜å†…èšä½è€¦åˆï¼ˆwahtï¼‰ï¼Ÿä¸ºä»€ä¹ˆè¦é«˜å†…èšã€ä½è€¦åˆ(why)ï¼ŸæŒ‰ä¸‹ä¸è¡¨ï¼Œå°±å…ˆè¯´è¯´ä¸€ç§èƒ½å¤Ÿè®©ä½ çš„ä»£ç é«˜å†…èšä½è€¦åˆçš„æ–¹æ³•ï¼š <strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>,è¿™ç§è®¾è®¡æ¨¡å¼æˆ‘è®¤ä¸ºå°±å’Œç­–ç•¥æ¨¡å¼ä¸€æ ·çš„å¸¸ç”¨ï¼Œè¿™ä¸¤ç§è®¾è®¡æ¨¡å¼ä¸ä»…å®ç°èµ·æ¥ç®€å•ï¼Œè€Œä¸”æ•ˆæœè¿˜å¥½ï¼å…¶ä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼<strong>ç®€ç›´æ˜¯é™ä½æ¨¡å—è€¦åˆæ€§æé«˜æˆ‘ä»¬ä»£ç é€¼æ ¼çš„ç¥å¥‡å•Šï¼</strong> é‚£æ¥ä¸‹æ¥å°±å…ˆè¯´è¯´è§‚å¯Ÿè€…æ¨¡å¼ç»„æˆè§’è‰²ï¼š</p>
<h5 id="æŠ½è±¡ä¸»é¢˜-Subject"><a href="#æŠ½è±¡ä¸»é¢˜-Subject" class="headerlink" title="æŠ½è±¡ä¸»é¢˜(Subject)"></a>æŠ½è±¡ä¸»é¢˜(Subject)</h5><p>å®ƒæŠŠæ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°ä¸€ä¸ªå®¹å™¨é‡Œï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å¯ä»¥æœ‰ä»»ä½•æ•°é‡çš„è§‚å¯Ÿè€…ã€‚æŠ½è±¡ä¸»é¢˜æä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ã€‚</p>
<h5 id="å…·ä½“ä¸»é¢˜-ConcreteSubject"><a href="#å…·ä½“ä¸»é¢˜-ConcreteSubject" class="headerlink" title="å…·ä½“ä¸»é¢˜(ConcreteSubject)"></a>å…·ä½“ä¸»é¢˜(ConcreteSubject)</h5><p>å°†æœ‰å…³çŠ¶æ€å­˜å…¥å…·ä½“è§‚å¯Ÿè€…å¯¹è±¡ï¼›åœ¨å…·ä½“ä¸»é¢˜å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œç»™æ‰€æœ‰ç™»è®°è¿‡çš„è§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ã€‚</p>
<h5 id="æŠ½è±¡æŠ½è±¡è§‚å¯Ÿè€…-Observer"><a href="#æŠ½è±¡æŠ½è±¡è§‚å¯Ÿè€…-Observer" class="headerlink" title="æŠ½è±¡æŠ½è±¡è§‚å¯Ÿè€…(Observer)"></a>æŠ½è±¡æŠ½è±¡è§‚å¯Ÿè€…(Observer)</h5><p>ä¸ºæ‰€æœ‰çš„å…·ä½“è§‚å¯Ÿè€…å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œåœ¨å¾—åˆ°ä¸»é¢˜é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±ã€‚</p>
<h5 id="å…·ä½“è§‚å¯Ÿè€…-ConcreteObserver"><a href="#å…·ä½“è§‚å¯Ÿè€…-ConcreteObserver" class="headerlink" title="å…·ä½“è§‚å¯Ÿè€…(ConcreteObserver)"></a>å…·ä½“è§‚å¯Ÿè€…(ConcreteObserver)</h5><p>å®ç°æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²æ‰€è¦æ±‚çš„æ›´æ–°æ¥å£ï¼Œä»¥ä¾¿ä½¿æœ¬èº«çš„çŠ¶æ€ä¸ä¸»é¢˜çŠ¶æ€åè°ƒã€‚</p>
<h6 id="JavaåŸç”Ÿå®ç°"><a href="#JavaåŸç”Ÿå®ç°" class="headerlink" title="JavaåŸç”Ÿå®ç°"></a>JavaåŸç”Ÿå®ç°</h6><p>Javaä»JDK1.0å¼€å§‹å°±è‡ªå¸¦äº† <code>java.util.Observer</code> å’Œ <code>java.util.Observable</code> ,ç›¸å…³æ¥å£ã€ç±»æ¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œç”±æ­¤å¯è§Javaå¯¹äºè§‚å¯Ÿè€…æ¨¡å¼çš„é‡è§†ï¼Œä¹Ÿä»å¦ä¸€æ–¹é¢è¯´æ˜è§‚å¯Ÿè€…æ¨¡å¼æ˜¯å¤šä¹ˆé‡è¦ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹ç”¨Javaè‡ªå¸¦çš„æ¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„ç¼–ç ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬ä»¥ä¸€ä¸ªä¸‹å•çš„åœºæ™¯æ¥ä¸¾ä¾‹æè¿°ï¼Œç”¨æˆ·åˆ›å»ºå®Œè®¢å•ï¼Œè¦å‘é€ä¸€ä¸ªæ¶ˆæ¯é€šçŸ¥ç”¨æˆ·è®¢å•åˆ›å»ºæˆåŠŸï¼Œè¿˜è¦å‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™ä»“åº“ï¼Œæ£€æŸ¥å¯¹åº”çš„è®¢å•å•†å“ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ã€‚</p>
<h4 id="1-ç»§æ‰¿java-util-Observableå®šä¹‰ä¸»é¢˜"><a href="#1-ç»§æ‰¿java-util-Observableå®šä¹‰ä¸»é¢˜" class="headerlink" title="1. ç»§æ‰¿java.util.Observableå®šä¹‰ä¸»é¢˜"></a>1. ç»§æ‰¿<code>java.util.Observable</code>å®šä¹‰ä¸»é¢˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderSubject</span> <span class="keyword">extends</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢å•çŠ¶æ€å‘ç”Ÿå˜åŒ–é€šçŸ¥å…¶ä»–ï¼Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(String status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="comment">// é€šçŸ¥å…¶ä»–</span></span><br><span class="line">        <span class="keyword">this</span>.setChanged();</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯å¯ä»¥æºå¸¦ä¸€äº›é¢å¤–çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-å®ç°java-util-Observeræ¥å£å®šä¹‰è§‚å¯Ÿè€…"><a href="#2-å®ç°java-util-Observeræ¥å£å®šä¹‰è§‚å¯Ÿè€…" class="headerlink" title="2. å®ç°java.util.Observeræ¥å£å®šä¹‰è§‚å¯Ÿè€…"></a>2. å®ç°<code>java.util.Observer</code>æ¥å£å®šä¹‰è§‚å¯Ÿè€…</h4><p><code>java.util.Observer</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­åªæœ‰ä¸€ä¸ª <code>update</code> æ–¹æ³•ã€‚æ¯å½“æ›´æ”¹è¢«è§‚å¯Ÿå¯¹è±¡æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚ åº”ç”¨ç¨‹åºè°ƒç”¨Observableå¯¹è±¡çš„ <code>notifyObservers</code>æ–¹æ³•ï¼Œä»¥å°†æ›´æ”¹é€šçŸ¥ç»™æ‰€æœ‰å¯¹è±¡çš„è§‚å¯Ÿè€…ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­é€šçŸ¥æ¨¡å—ã€ä»“åº“æ¨¡å—å°±æ˜¯æ‰®æ¼”è§‚å¯Ÿè€…çš„è§’è‰²ï¼Œå…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<ul>
<li>é€šçŸ¥æ¨¡å—å®ç°<code>java.util.Observer</code>æ¥å£</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoticeObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable o, Object arg)</span> </span>&#123;</span><br><span class="line">        OrderSubject orderSubject = (OrderSubject) o;</span><br><span class="line">        log.info(<span class="string">"é€šçŸ¥ä¸­å¿ƒæ”¶åˆ°äº†è®¢å•çš„å˜åŒ–[&#123;&#125;],arg = [&#123;&#125;]"</span>, orderSubject.getStatus(),arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»“åº“æ¨¡å—å®ç°<code>java.util.Observer</code>æ¥å£</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WareHouseObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable observable, Object arg)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        OrderSubject orderSubject = (OrderSubject) observable;</span><br><span class="line">        log.info(<span class="string">"ä»“åº“è§‚å¯Ÿè€…æ”¶åˆ°äº†è®¢å•çš„å˜åŒ–[&#123;&#125;],arg = [&#123;&#125;]"</span>, orderSubject.getStatus(), arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-ä»£ç ç¼–å†™å®Œæˆï¼Œæµ‹è¯•ä¸€æŠŠ"><a href="#3-ä»£ç ç¼–å†™å®Œæˆï¼Œæµ‹è¯•ä¸€æŠŠ" class="headerlink" title="3. ä»£ç ç¼–å†™å®Œæˆï¼Œæµ‹è¯•ä¸€æŠŠ"></a>3. ä»£ç ç¼–å†™å®Œæˆï¼Œæµ‹è¯•ä¸€æŠŠ</h4><p>å…·ä½“æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserverTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        OrderSubject orderSubject = <span class="keyword">new</span> OrderSubject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šçŸ¥ç³»ç»Ÿç›‘å¬è€…</span></span><br><span class="line">        NoticeObserver noticeObserver = <span class="keyword">new</span> NoticeObserver();</span><br><span class="line">        orderSubject.addObserver(noticeObserver);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»“åº“ç›‘å¬è€…</span></span><br><span class="line">        WareHouseObserver wareHouseObserver = <span class="keyword">new</span> WareHouseObserver();</span><br><span class="line">        orderSubject.addObserver(wareHouseObserver);</span><br><span class="line">         <span class="comment">// è®¢å•åˆ›å»º</span></span><br><span class="line">        orderSubject.setStatus(<span class="string">"è®¢å•åˆ›å»ºå•¦"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¢å•ä»˜æ¬¾</span></span><br><span class="line">        orderSubject.setStatus(<span class="string">"è®¢å•ä»˜æ¬¾å•¦"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®¢å•çš„çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¹åº”çš„è§‚å¯Ÿè€…å°±æ¥å—åˆ°äº†é€šçŸ¥ã€‚JDKæä¾›çš„å®ç°å¾ˆç®€å•ï¼Œä½†æ˜¯ç¼ºé™·ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ã€‚</p>
<ul>
<li><p><code>Observable</code> æ˜¯ä¸€ä¸ªç±»ï¼Œä¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸ç»§æ‰¿è¯¥ç±»æ— æ³•ä½¿ç”¨æƒé™ç±»å‹ä¸º protected çš„<code>setChanged()</code>å’Œ <code>clearChanged()</code>æ–¹æ³•ã€‚</p>
</li>
<li><p>ç”¨<code>Vector&lt;Observer&gt;</code>ä¿å­˜è§‚å¯Ÿè€…ã€‚<code>Vector</code>æ•ˆç‡ä½ä¸‹ï¼ŒJDKå·²ç»ä¸å»ºè®®ä½¿ç”¨äº†ã€‚</p>
</li>
<li><p>ä¸»é¢˜å˜åŒ–é€šçŸ¥è§‚å¯Ÿè€…çš„é¡ºåºæ— æ³•è‡ªå®šä¹‰ã€‚é€šçŸ¥çš„é¡ºåºæ˜¯å›ºå®šä¸ºæŒ‰ç…§è®¾ç½®è§‚å¯Ÿè€…çš„æ—¶é—´å€’å™é€šçŸ¥ï¼Œæ— æ³•è‡ªå®šä¹‰ã€‚</p>
</li>
<li><p>æ•´ä½“ä»£ç æ‰§è¡Œæ˜¯åŒæ­¥çš„ï¼Œä¸èƒ½è®¾ç½®ä¸ºå¼‚æ­¥ã€‚ä¸”è§‚å¯Ÿè€…çš„æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œç¨‹åºå¤„ç†ä¸åˆ°ä½ä¼šå¯¼è‡´<strong>äº‹åŠ¡å›æ»š</strong>ã€‚</p>
</li>
</ul>
<p>æ—¢ç„¶JDKä¸­å®ç°ä¸å¤Ÿå®Œç¾ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹æœ‰æ²¡æœ‰å…¶ä»–çš„å®ç°æ–¹å¼ã€‚Googleçš„Guavaå·¥å…·åŒ…æä¾›äº†EventBuså¯ä»¥å®ç°ã€Springæ¡†æ¶ä¸­ä¹Ÿæä¾›äº†ç›¸åº”çš„æ”¯æŒï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨Springæ¡†æ¶æ¯”è¾ƒå¤šï¼Œä»Šå¤©æˆ‘ä»¬å°±å…ˆæ¥è¯´è¯´Springæ¡†æ¶ä¸­æ˜¯å¦‚ä½•å®ç°å¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„æ”¯æŒå§ï¼</p>
<h6 id="Springä¸­çš„å®ç°"><a href="#Springä¸­çš„å®ç°" class="headerlink" title="Springä¸­çš„å®ç°"></a>Springä¸­çš„å®ç°</h6><p>Springæ¡†æ¶ä¸­æä¾›äº†ç›¸å½“å¤šçš„ç»„ä»¶å¯ä»¥å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ–‡ç« åé¢ä¼šä¸€ä¸€å‘å¤§å®¶ä»‹ç»ã€‚è¿™é‡Œæˆ‘å¼•å…¥ä¸€ä¸ªæ–°çš„ä¸šåŠ¡åœºæ™¯ï¼Œç”¨æˆ·æ³¨å†Œä¹‹åå‘é€çŸ­ä¿¡é€šçŸ¥ã€ç§¯åˆ†è¿˜æœ‰ä¼˜æƒ åˆ¸ã€‚è¿™ç§ä¸šåŠ¡åœºæ™¯éå¸¸çš„å¸¸è§ï¼Œæˆ‘å±•ç¤ºä¸€ä¸‹å°ä¼™ä¼´ä»¬ä¸€èˆ¬æ˜¯æ€ä¹ˆæ ·å®ç°è¿™æ ·çš„åŠŸèƒ½çš„ã€‚å› ä¸ºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œå°±å±•ç¤ºä¸€ä¸‹ä¼ªä»£ç å§ï¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberService</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> MemberDao memberDao;</span><br><span class="line">  </span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> CouponService couponService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> SmsService smsService;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®Œæˆç”¨æˆ·æ³¨å†Œï¼ŒæˆåŠŸä¹‹åå‘é€ä¼˜æƒ åˆ¸ã€çŸ­ä¿¡é€šçŸ¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> memberName æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone åˆ†é¡µä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Result <span class="title">normalRegister</span><span class="params">(String memberName,String phone)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">        log.info(<span class="string">"[register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]"</span>, phone);</span><br><span class="line">        <span class="comment">// ä¿å­˜ç”¨æˆ·</span></span><br><span class="line">        Long memberId = memberDao.saveMember();</span><br><span class="line">        <span class="comment">// 2ã€å‘é€ä¼˜æƒ åˆ¸</span></span><br><span class="line">        couponService.sendCoupon(memberId);</span><br><span class="line">        <span class="comment">// 3ã€å‘é€çŸ­ä¿¡</span></span><br><span class="line">        smsService.sendSms(phone);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¤§å®¶å¯¹è¿™éƒ¨åˆ†ä»£ç æ€ä¹ˆçœ‹ï¼Ÿ</strong></p>
<p>å¯¹äºç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ¥è¯´ï¼Œä¿éšœç”¨æˆ·æˆåŠŸæ³¨å†Œï¼Œè¿™æ˜¯ä¸ªä¸šåŠ¡çš„æ ¸å¿ƒè¯‰æ±‚ï¼Œå…¶ä»–çš„éƒ½æ˜¯é”¦ä¸Šæ·»èŠ±ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ä¸åº”è¯¥æºæ‚å…¶ä»–çš„ä¸šåŠ¡ã€‚ç”¨æˆ·æ³¨å†Œä¸å‘é€çŸ­ä¿¡ã€ä¼˜æƒ åˆ¸åŠŸèƒ½åº”è¯¥åˆ†éš”å¼€ï¼Œè¿™æ ·ä¹Ÿç¬¦åˆè§£è€¦çš„è®¾è®¡è§„åˆ™ã€‚ä¸ç„¶åç»­ä¸šåŠ¡å¢åŠ éœ€æ±‚ï¼Œéœ€è¦ç”¨æˆ·æ³¨å†Œå®Œæˆä¹‹åç»™ç”¨æˆ·å‘é€ç§¯åˆ†ï¼Œä½ æ˜¯ä¸æ˜¯è¿˜è¦åœ¨è¿™ä¸ª <code>normalRegister</code>æ–¹æ³•ä¸­å¢åŠ å‘é€ç§¯åˆ†çš„é€»è¾‘ï¼Œé‚£è¿™ä¸ªå²‚ä¸æ˜¯åˆè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚</p>
<blockquote>
<p>ä¸€ä»¶äº‹åšå®¹æ˜“ï¼Œæƒ³åšå¥½ä¸å®¹æ˜“ã€‚å†™ç¨‹åºä¹Ÿæ˜¯å¦‚æ­¤ï¼Œèƒ½å¤ŸæŠŠåŠŸèƒ½ç¼–ç å®ç°bugåˆå°‘ï¼Œå…¶å®æ˜¯å¾ˆè€—è´¹æ—¶é—´å’Œç²¾åŠ›çš„ã€‚æˆ‘å¸¸è·ŸåŒäº‹ä»¬å¼€ç©ç¬‘è¯´â€œå†™ä»£ç ä¸è¦ç³Šå¼„ï¼Œè¯¥å†™çš„ä»£ç ä¸€å®šè¦å†™ï¼Œä¸ç„¶ä½ æœ€åè‚¯å®šä¼šè¢«ä»£ç ç³Šå¼„â€ã€‚</p>
</blockquote>
<p><strong>æ¥ä¸‹æ¥æˆ‘æ¥ä»‹ç»ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Springçš„äº‹ä»¶å‘å¸ƒæœºåˆ¶æ¥å®ç°ä¸šåŠ¡è§£è€¦çš„</strong></p>
<p>ç”±äºåé¢çš„å®ç°æ–¹æ³•ä¸­ç”¨æˆ·æ³¨å†Œäº‹ä»¶ç±»çš„ä»£ç éƒ½æ˜¯ç±»ä¼¼çš„åªæ˜¯ç±»åä¸åŒï¼Œé‚£æˆ‘å°±æŠŠç”¨æˆ·æ³¨å†Œäº‹ä»¶ç±»çš„ä»£ç å†™åœ¨å‰é¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEvent;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRegisterEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯ä»¥è‡ªå®šä¹‰äº›è‡ªå·±éœ€è¦çš„å±æ€§</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·çš„id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long memberId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String memberPhone;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserRegisterEvent</span><span class="params">(Object source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserRegisterEvent</span><span class="params">(Object source, Long memberId, String memberPhone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">        <span class="keyword">this</span>.memberId = memberId;</span><br><span class="line">        <span class="keyword">this</span>.memberPhone = memberPhone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åˆ©ç”¨ç»§æ‰¿ApplicationEventç±»ã€å®ç°ApplicationListeneræ¥å£æˆ–è€…-EventListeneræ³¨è§£æ¥å®ç°"><a href="#åˆ©ç”¨ç»§æ‰¿ApplicationEventç±»ã€å®ç°ApplicationListeneræ¥å£æˆ–è€…-EventListeneræ³¨è§£æ¥å®ç°" class="headerlink" title="åˆ©ç”¨ç»§æ‰¿ApplicationEventç±»ã€å®ç°ApplicationListeneræ¥å£æˆ–è€…  @EventListeneræ³¨è§£æ¥å®ç°"></a>åˆ©ç”¨ç»§æ‰¿<code>ApplicationEvent</code>ç±»ã€å®ç°<code>ApplicationListener</code>æ¥å£æˆ–è€…  <code>@EventListener</code>æ³¨è§£æ¥å®ç°</h5><p><code>org.springframework.context.ApplicationListener</code>æ˜¯Springæä¾›çš„ä¸€ä¸ªæ³›å‹æ¥å£ã€‚ç”±åº”ç”¨ç¨‹åºäº‹ä»¶ä¾¦å¬å™¨å®ç°çš„æ¥å£,ä»Spring 3.0å¼€å§‹ï¼Œ<code>ApplicationListener</code>å¯ä»¥ä¸€èˆ¬æ€§åœ°å£°æ˜å…¶æ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹ã€‚åœ¨Spring ApplicationContextä¸­æ³¨å†Œåï¼Œå°†ç›¸åº”åœ°è¿‡æ»¤äº‹ä»¶ï¼Œå¹¶ä¸”ä»…é’ˆå¯¹åŒ¹é…äº‹ä»¶å¯¹è±¡è°ƒç”¨ä¾¦å¬å™¨ã€‚è§‚å¯Ÿè€…å¯ä»¥å®ç°<code>ApplicationListener</code>æ¥å£æˆ–è€…ä½¿ç”¨<code>@EventListener</code>æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å’Œ<code>ApplicationListener</code>æ¥å£æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œç›¸æ¯”ä¹‹ä¸‹ä½¿ç”¨æ³¨è§£æ¯”ä½¿ç”¨æ¥å£æ›´æ–¹ä¾¿ä¸€ç‚¹ã€‚</p>
<h4 id="çŸ­ä¿¡Serviceå®ç°ApplicationListeneræ¥å£"><a href="#çŸ­ä¿¡Serviceå®ç°ApplicationListeneræ¥å£" class="headerlink" title="çŸ­ä¿¡Serviceå®ç°ApplicationListeneræ¥å£"></a>çŸ­ä¿¡Serviceå®ç°ApplicationListeneræ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">(UserRegisterEvent event)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"[EventListener][ç»™ç”¨æˆ·(&#123;&#125;) å‘é€çŸ­ä¿¡]"</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¼˜æƒ åˆ¸Serviceç›´æ¥åœ¨addCoupon-æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£-EventListener"><a href="#ä¼˜æƒ åˆ¸Serviceç›´æ¥åœ¨addCoupon-æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£-EventListener" class="headerlink" title="ä¼˜æƒ åˆ¸Serviceç›´æ¥åœ¨addCoupon æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ @EventListener"></a>ä¼˜æƒ åˆ¸Serviceç›´æ¥åœ¨<code>addCoupon</code> æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ <code>@EventListener</code></h4><p>æ³¨æ„<code>addCoupon</code> æ–¹æ³•çš„å…¥å‚ä¸º <code>UserRegisterEvent</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouponService</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">UserRegisterEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(UserRegisterEvent event)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"[addCoupon][ç»™ç”¨æˆ·(&#123;&#125;) å‘æ”¾ä¼˜æƒ åŠµ]"</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç§¯åˆ†Serviceä¸­çš„ä»£ç ä¸ä¸Šé¢çš„ç±»ä¼¼å°±ä¸è´´å‡ºæ¥äº†</strong></p>
<h4 id="æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒUserRegisterEventäº‹ä»¶"><a href="#æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒUserRegisterEventäº‹ä»¶" class="headerlink" title="æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒUserRegisterEventäº‹ä»¶"></a>æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒ<code>UserRegisterEvent</code>äº‹ä»¶</h4><p>è¿™ä¸ªåœ°æ–¹MemberServiceè¦å®ç°<code>org.springframework.beans.factory.Aware.ApplicationEventPublisherAware</code>æ¥å£ï¼Œæ‰æœ‰èƒ½åŠ›ä½¿ç”¨ <code>ApplicationEventPublisher</code> å‘å¸ƒäº‹ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberService</span> <span class="keyword">implements</span> <span class="title">ApplicationEventPublisherAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationEventPublisher = applicationEventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€ç®€å•çš„è§‚å¯Ÿè€…å®ç°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone ç”¨æˆ·æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">register</span><span class="params">(String memberPhone)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€ ... æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">        log.info(<span class="string">"[register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]"</span>, memberPhone);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“</span></span><br><span class="line">        Long memberId = <span class="number">1000L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3ã€å‘å¸ƒäº‹ä»¶é€šçŸ¥</span></span><br><span class="line">        applicationEventPublisher.publishEvent(<span class="keyword">new</span> UserRegisterEvent(<span class="keyword">this</span>, memberId, memberPhone));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;<span class="string">"classpath:spring/spring-dao.xml"</span>, <span class="string">"classpath:spring/spring-service.xml"</span>&#125;)</span><br><span class="line"><span class="meta">@RunWith</span>(value = SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ObserverTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        memberService.register(<span class="string">"13911111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ‰§è¡Œç»“æœ"><a href="#æ‰§è¡Œç»“æœ" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h4><p><img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230758.png" alt="å‘é€çŸ­ä¿¡åœ¨å‘é€ä¼˜æƒ åˆ¸ä¹‹å‰"></p>
<p>ä»£ç æ‰§è¡ŒæˆåŠŸï¼Œæ‰“å°å‡ºäº†ç»™ç”¨æˆ·å‘é€çŸ­ä¿¡ã€ä¼˜æƒ åˆ¸æ—¥å¿—ï¼ŒåŠŸèƒ½å®Œç¾å®ç°ã€‚ä½†æ˜¯ç¨å¾®æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘æƒ³è°ƒæ¢ä¸€ä¸‹ä¸¤è€…çš„é¡ºåºï¼Œå…ˆæ‰§è¡Œå‘é€ä¼˜æƒ åˆ¸ï¼Œå†å‘é€çŸ­ä¿¡ã€‚è¿™ä¸ªè¦æ±‚è¿˜æ˜¯è›®å¸¸è§ï¼Œé‚£æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p>
<h5 id="ä½¿ç”¨SmartApplicationListeneræˆ–è€…GenericApplicationListeneræ¥å£å®ç°æŒ‡å®šè§‚å¯Ÿè€…è‡ªå®šä¹‰é¡ºåºæ‰§è¡Œ"><a href="#ä½¿ç”¨SmartApplicationListeneræˆ–è€…GenericApplicationListeneræ¥å£å®ç°æŒ‡å®šè§‚å¯Ÿè€…è‡ªå®šä¹‰é¡ºåºæ‰§è¡Œ" class="headerlink" title="ä½¿ç”¨SmartApplicationListeneræˆ–è€…GenericApplicationListeneræ¥å£å®ç°æŒ‡å®šè§‚å¯Ÿè€…è‡ªå®šä¹‰é¡ºåºæ‰§è¡Œ"></a>ä½¿ç”¨<code>SmartApplicationListener</code>æˆ–è€…<code>GenericApplicationListener</code>æ¥å£å®ç°æŒ‡å®šè§‚å¯Ÿè€…è‡ªå®šä¹‰é¡ºåºæ‰§è¡Œ</h5><p><code>org.springframework.context.event.SmartApplicationListener</code>æ˜¯Spring3.0ç‰ˆæœ¬æä¾›çš„æ¥å£ï¼Œ<code>org.springframework.context.event.GenericApplicationListener</code>åˆ™æ˜¯Spring4.2ç‰ˆæœ¬æä¾›çš„æ¥å£ï¼Œå¦‚æœåœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨ä¸äº†ï¼Œé‚£å°±æ˜¯è¯´æ˜ä½ é¡¹ç›®ä¸­ä½¿ç”¨çš„Springç‰ˆæœ¬è¿‡ä½ï¼Œè¿™ä¸ªé—®é¢˜è‡ªå·±è‡ªè¡Œå¤„ç†ã€‚<br>åœ¨æŸ¥<code>SmartApplicationListener</code>æºç æ—¶å‘ç°æœ‰ä»¥ä¸‹æ³¨é‡Šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Extended variant of the standard &#123;<span class="meta">@link</span> ApplicationListener&#125; <span class="class"><span class="keyword">interface</span>,</span></span><br><span class="line"><span class="class"><span class="title">exposing</span> <span class="title">further</span> <span class="title">metadata</span> <span class="title">such</span> <span class="title">as</span> <span class="title">the</span> <span class="title">supported</span> <span class="title">event</span> <span class="title">type</span>.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;<span class="title">p</span>&gt;<span class="title">Users</span> <span class="title">are</span> &lt;<span class="title">bold</span>&gt;<span class="title">strongly</span> <span class="title">advised</span>&lt;/<span class="title">bold</span>&gt; <span class="title">to</span> <span class="title">use</span> <span class="title">the</span> </span>&#123;<span class="meta">@link</span> GenericApplicationListener&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">instead</span> <span class="title">as</span> <span class="title">it</span> <span class="title">provides</span> <span class="title">an</span> <span class="title">improved</span> <span class="title">detection</span> <span class="title">of</span> <span class="title">generics</span>-<span class="title">based</span></span></span><br><span class="line"><span class="class"><span class="title">event</span> <span class="title">types</span>.</span></span><br></pre></td></tr></table></figure>

<p>ç¿»è¯‘ä¹‹åå¤§æ¦‚çš„æ„æ€å°±æ˜¯ï¼Œ<strong>SmartApplicationListeneræ˜¯æ ‡å‡†<code>ApplicationListener</code>æ¥å£çš„æ‰©å±•å˜ä½“ï¼Œå…¬å¼€äº†è¿›ä¸€æ­¥çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚å—æ”¯æŒçš„äº‹ä»¶ç±»å‹ã€‚ä½†å¼ºçƒˆå»ºè®®æ”¹ç”¨<code>GenericApplicationListener</code>æ¥å£ï¼Œå› ä¸ºå®ƒæä¾›äº†å¯¹åŸºäºæ³›å‹çš„äº‹ä»¶ç±»å‹çš„æ”¹è¿›æ£€æµ‹</strong>ï¼Œé‚£æˆ‘æ­¤å¤„å°±åªä»¥GenericApplicationListenerä¸ºä¾‹äº†ã€‚</p>
<p>ä¼˜æƒ åˆ¸æœåŠ¡ServiceåŒæ ·å®ç°æ¥å£ <code>GenericApplicationListener</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondVersionCouponService</span> <span class="keyword">implements</span> <span class="title">GenericApplicationListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¡®å®šæ­¤ä¾¦å¬å™¨æ˜¯å¦å®é™…ä¸Šæ”¯æŒç»™å®šçš„äº‹ä»¶ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsEventType</span><span class="params">(ResolvableType eventType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SecondVersionUserRegisterEvent<span class="class">.<span class="keyword">class</span>.<span class="title">equals</span>(<span class="title">eventType</span>.<span class="title">getRawClass</span>())</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¡®å®šæ­¤ä¾¦å¬å™¨æ˜¯å¦å®é™…ä¸Šæ”¯æŒç»™å®šçš„æºç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sourceType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsSourceType</span><span class="params">(Class&lt;?&gt; sourceType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MemberService<span class="class">.<span class="keyword">class</span> </span>== sourceType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…·ä½“çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> event</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">        SecondVersionUserRegisterEvent userRegisterEvent = (SecondVersionUserRegisterEvent) event;</span><br><span class="line">        Long memberId = userRegisterEvent.getMemberId();</span><br><span class="line">        log.info(<span class="string">"[Second addCoupon][ç»™ç”¨æˆ·(&#123;&#125;) å‘æ”¾ä¼˜æƒ åŠµ]"</span>, memberId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾å®šæ‰§è¡Œçš„é¡ºåºï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜å°±è¶Šå…ˆè¢«æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çŸ­ä¿¡æœåŠ¡ServiceåŒæ ·å®ç°æ¥å£ <code>GenericApplicationListener</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondVersionSmsService</span> <span class="keyword">implements</span> <span class="title">GenericApplicationListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsEventType</span><span class="params">(ResolvableType eventType)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> SecondVersionUserRegisterEvent<span class="class">.<span class="keyword">class</span> </span>== eventType.getRawClass();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsSourceType</span><span class="params">(Class&lt;?&gt; sourceType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MemberService<span class="class">.<span class="keyword">class</span> </span>== sourceType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">        SecondVersionUserRegisterEvent userRegisterEvent = (SecondVersionUserRegisterEvent) event;</span><br><span class="line">        String memberPhone = userRegisterEvent.getMemberPhone();</span><br><span class="line">        log.info(<span class="string">"[Second onApplicationEvent][ç»™ç”¨æˆ·(&#123;&#125;) å‘é€çŸ­ä¿¡]"</span>, memberPhone);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…¶å®ä½¿ç”¨<code>org.springframework.context.ApplicationListener</code> + <code>org.springframework.core.annotation.Order</code>æ³¨è§£ä¹Ÿå¯ä»¥å®ç°æ§åˆ¶è§‚å¯Ÿè€…çš„æ‰§è¡Œé¡ºåºï¼Œè€Œä¸”æ›´ç®€æ´ï¼</p>
</blockquote>
<h4 id="æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒUserRegisterEventäº‹ä»¶-1"><a href="#æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒUserRegisterEventäº‹ä»¶-1" class="headerlink" title="æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒUserRegisterEventäº‹ä»¶"></a>æ³¨å†Œä¸šåŠ¡å®Œæˆå‘å¸ƒ<code>UserRegisterEvent</code>äº‹ä»¶</h4><p>è¿™ä¸ªåœ°æ–¹MemberServiceè¦å®ç°<code>org.springframework.beans.factory.Aware.ApplicationEventPublisherAware</code>æ¥å£ï¼Œæ‰æœ‰èƒ½åŠ›ä½¿ç”¨ <code>ApplicationEventPublisher</code> å‘å¸ƒäº‹ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberService</span> <span class="keyword">implements</span> <span class="title">ApplicationEventPublisherAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher applicationEventPublisher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher applicationEventPublisher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationEventPublisher = applicationEventPublisher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€ç®€å•çš„è§‚å¯Ÿè€…å®ç°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone ç”¨æˆ·æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Result</span> <span class="title">register</span>(<span class="title">String</span> <span class="title">phone</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€ ... æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">        log.info(<span class="string">"[Second register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]"</span>, phone);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€ ä¿å­˜ç”¨æˆ·åˆ°æ•°æ®åº“ï¼ˆå‡è®¾è¿™ä¸ªæ˜¯ï¼‰</span></span><br><span class="line">        BizLocalMessageEntity entity = <span class="keyword">new</span> BizLocalMessageEntity();</span><br><span class="line">        ThreadLocalRandom random = ThreadLocalRandom.current();</span><br><span class="line">        entity.setBizModule((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">        entity.setBizNo(<span class="string">""</span> + random.nextInt(<span class="number">100000</span>));</span><br><span class="line">        entity.setBizType((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">        entity.setSendStatus((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">        entity.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        entity.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> affectRow = bizLocalMessageMapper.insert(entity);</span><br><span class="line">        Long memberId = entity.getId();</span><br><span class="line">        log.info(<span class="string">"æ’å…¥çš„affectRow= [&#123;&#125;],ä¸»é”®[&#123;&#125;]"</span>, affectRow, memberId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3ã€å‘å¸ƒäº‹ä»¶é€šçŸ¥</span></span><br><span class="line">        applicationEventPublisher.publishEvent(<span class="keyword">new</span> SecondVersionUserRegisterEvent(<span class="keyword">this</span>, memberId, phone));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å•å…ƒæµ‹è¯•-1"><a href="#å•å…ƒæµ‹è¯•-1" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;<span class="string">"classpath:spring/spring-dao.xml"</span>, <span class="string">"classpath:spring/spring-service.xml"</span>&#125;)</span><br><span class="line"><span class="meta">@RunWith</span>(value = SpringJUnit4ClassRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ObserverTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        memberService.register(<span class="string">"13911111111"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ‰§è¡Œç»“æœ-1"><a href="#æ‰§è¡Œç»“æœ-1" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h4><p><img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230024.png" alt="è¿è¡Œæˆªå›¾"></p>
<p>ä¿®æ”¹ä¸¤ä¸ªServiceä¸­orderçš„æ•°å€¼å¯ä»¥è½»æ¾ä¸¤ä¸ªè§‚å¯Ÿè€…çš„æ‰§è¡Œé¡ºåºï¼Œå®Œç¾çš„è§£å†³äº†è‡ªå®šä¹‰è§‚å¯Ÿè€…æ‰§è¡Œé¡ºåºçš„è¦æ±‚ã€‚ç»†å¿ƒçš„å°ä¼™ä¼´ä¼šå‘ç°ï¼Œå‡è®¾åœ¨ç”¨æˆ·æ³¨å†Œçš„æ–¹æ³•ä¸­å­˜åœ¨äº‹åŠ¡ï¼Œè§‚å¯Ÿè€…çš„æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å›æ»šï¼Œæ˜æ˜ç”¨æˆ·çš„æ•°æ®å·²ç»ä¿å­˜åˆ°æ•°æ®åº“ï¼Œç°åœ¨å´æ²¡æœ‰äº†ï¼è¿˜æ˜¯å‰é¢é‚£å¥è¯ï¼Œåœ¨è¿™ä¸ªä¸šåŠ¡åœºæ™¯ï¼Œç”¨æˆ·æ³¨å†ŒæˆåŠŸæ˜¯æ ¸å¿ƒè¯‰æ±‚ï¼Œå‘é€çŸ­ä¿¡ã€ä¼˜æƒ åˆ¸é‡è¦æ€§éƒ½æ˜¯æ¯”ä¸ä¸Šçš„ã€‚é‚£è¦è§£å†³è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦ç”¨æˆ·æ³¨å†ŒæˆåŠŸçš„äº‹åŠ¡æäº¤ä¹‹åï¼Œå†å‘å¸ƒæ³¨å†ŒæˆåŠŸäº‹ä»¶ï¼Œé¿å…è§‚å¯Ÿè€…æ‰§è¡Œç»“æœçš„å½±å“ã€‚</p>
<p><strong>çŸ­ä¿¡æœåŠ¡Serviceæœ‰æœ‰å¼‚å¸¸æŠ›å‡ºå¯¼è‡´äº‹åŠ¡å›æ»š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">       SecondVersionUserRegisterEvent userRegisterEvent = (SecondVersionUserRegisterEvent) event;</span><br><span class="line">       String memberPhone = userRegisterEvent.getMemberPhone();</span><br><span class="line">       <span class="keyword">if</span> (StringUtils.isNotBlank(memberPhone)) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æµ‹è¯•äº‹ä»¶ä¸­å‘ç”Ÿå¼‚å¸¸å¯¹åŸæœ‰ä¸šåŠ¡çš„å½±å“,çŸ­ä¿¡å‘é€å¤±è´¥ï¼ï¼ï¼ï¼"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       log.info(<span class="string">"[Second onApplicationEvent][ç»™ç”¨æˆ·(&#123;&#125;) å‘é€çŸ­ä¿¡]"</span>, memberPhone);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204225825.png" alt="çŸ­ä¿¡è§‚å¯Ÿè€…æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸"></p>
<p>å¯èƒ½æœ‰çš„å°ä¼™ä¼´æƒ³ï¼Œè§‚å¯Ÿè€…æ‰§è¡Œå¼‚å¸¸å¯¼è‡´äº‹åŠ¡å›æ»šï¼Œæœ¬è´¨ä¸Šæ¥è¯´è¿™ç§æ–¹å¼å®ç°çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå…¶å®è¿˜æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­åŒæ­¥æ‰§è¡Œçš„ã€‚é‚£æˆ‘å°±åœ¨è§‚å¯Ÿè€…ä¸­æ•è·æ‰€æœ‰çš„å¼‚å¸¸æˆ–è€…ç”¨æˆ·æ³¨å†ŒæˆåŠŸä¹‹åå¼‚æ­¥å‘å¸ƒäº‹ä»¶ã€‚</p>
<ul>
<li><strong>æ•è·æ‰€æœ‰å¼‚å¸¸</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            SecondVersionUserRegisterEvent userRegisterEvent = (SecondVersionUserRegisterEvent) event;</span><br><span class="line">            Long memberId = userRegisterEvent.getMemberId();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (memberId != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æµ‹è¯•äº‹ä»¶ä¸­å‘ç”Ÿå¼‚å¸¸å¯¹åŸæœ‰ä¸šåŠ¡çš„å½±å“,çŸ­ä¿¡å‘é€å¤±è´¥ï¼ï¼ï¼ï¼"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(<span class="string">"[Second addCoupon][ç»™ç”¨æˆ·(&#123;&#125;) å‘æ”¾ä¼˜æƒ åŠµ]"</span>, memberId);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"å‘æ”¾ä¼˜æƒ åŠµå‘ç”Ÿå¼‚å¸¸"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>å¼‚æ­¥å‘å¸ƒäº‹ä»¶</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 3ã€å¼‚æ­¥å‘å¸ƒäº‹ä»¶é€šçŸ¥,è¿™æ ·çš„æœ‰å¯èƒ½äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œåˆ™å¼‚æ­¥çº¿ç¨‹è¯»å–ä¸åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®</span></span><br><span class="line">CompletableFuture&lt;Void&gt; voidCompletableFuture = CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">    applicationEventPublisher.publishEvent(<span class="keyword">new</span> UserRegisterEvent(<span class="keyword">this</span>, memberId, phone));</span><br><span class="line">&#125;);</span><br><span class="line">voidCompletableFuture.exceptionally(exception -&gt; &#123;</span><br><span class="line">    log.error(<span class="string">"å‘ç”Ÿäº†å¼‚å¸¸"</span>, exception);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ç§æ–¹å¼å¯ä»¥è§£å†³äº‹åŠ¡å›æ»šçš„é—®é¢˜ï¼Œä½†æ˜¯å‘¢æ„Ÿè§‰ä¼šæœ‰ç‚¹lowï¼</p>
<p>ç¬¬äºŒç§æ–¹å¼å‡å¦‚è§‚å¯Ÿè€…ä¸­æŸ¥è¯¢ä¼šå‘˜çš„ä¿¡æ¯ï¼Œå¯èƒ½å‡ºç°æŸ¥ä¸åˆ°ï¼Œå› ä¸ºå¯èƒ½äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ã€‚</p>
<h5 id="ä½¿ç”¨-TransactionalEventListener-å®ç°äº‹åŠ¡æäº¤ä¹‹åæ‰æ‰§è¡Œè§‚å¯Ÿè€…"><a href="#ä½¿ç”¨-TransactionalEventListener-å®ç°äº‹åŠ¡æäº¤ä¹‹åæ‰æ‰§è¡Œè§‚å¯Ÿè€…" class="headerlink" title="ä½¿ç”¨ @TransactionalEventListener å®ç°äº‹åŠ¡æäº¤ä¹‹åæ‰æ‰§è¡Œè§‚å¯Ÿè€…"></a>ä½¿ç”¨ <code>@TransactionalEventListener</code> å®ç°äº‹åŠ¡æäº¤ä¹‹åæ‰æ‰§è¡Œè§‚å¯Ÿè€…</h5><p>ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œç›´æ¥åœ¨å¯¹åº”çš„è§‚å¯Ÿè€…æ–¹æ³•ä¸Šæ·»åŠ è¯¥æ³¨è§£å³å¯ã€‚<code>@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeCouponService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TransactionalEventListener</span>(phase = TransactionPhase.AFTER_COMMIT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCoupon</span><span class="params">(ThreeUserRegisterEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"æµ‹è¯•äº‹ä»¶ä¸­å‘ç”Ÿå¼‚å¸¸å¯¹åŸæœ‰ä¸šåŠ¡çš„å½±å“"</span>);</span><br><span class="line">        Long memberId = event.getMemberId();</span><br><span class="line">        <span class="keyword">if</span> (memberId != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æµ‹è¯•äº‹ä»¶ä¸­å‘ç”Ÿå¼‚å¸¸å¯¹åŸæœ‰ä¸šåŠ¡çš„å½±å“,ä¼˜æƒ åˆ¸å‘é€å¤±è´¥ï¼ï¼ï¼ï¼"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">" Version=3 [addCoupon][ç»™ç”¨æˆ·(&#123;&#125;) å‘æ”¾ä¼˜æƒ åŠµ]"</span>, memberId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„ä¸€å®šè¦åœ¨ <code>register()</code> æ–¹æ³•ä¸Šæ·»åŠ  <code>@Transactional</code> æ³¨è§£</strong>ï¼Œä¸ç„¶ <code>register()</code> æ–¹æ³•ä¸­æœ‰æŠ›å‡ºå¼‚å¸¸ä¹‹åï¼Œä¼šæœ‰ä¸‹é¢çš„é”™è¯¯æç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¿¡æ¯: Closing org.springframework.context.support.GenericApplicationContext<span class="meta">@a</span>67c67e: </span><br><span class="line">startup date [Thu Feb <span class="number">04</span> <span class="number">18</span>:<span class="number">06</span>:<span class="number">53</span> CST <span class="number">2021</span>]; root of context hierarchy</span><br></pre></td></tr></table></figure>


<p><strong>@Transactionalä¸€å®šè¦åŠ ä¸Š</strong>ä¸ç„¶æ–¹æ³•ä½“å†…æœ‰ä¸€æ¬¡æŠ›å‡ºä¼šæœ‰ä¸Šçš„é”™è¯¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">Result</span> <span class="title">register</span>(<span class="title">String</span> <span class="title">phone</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1ã€ ... æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">    log.info(<span class="string">"[Second register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]"</span>, phone);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ã€ ä¿å­˜ç”¨æˆ·(å‡è®¾è¿™æ˜¯)</span></span><br><span class="line">    <span class="keyword">int</span> affectRow = bizLocalMessageMapper.insert(entity);</span><br><span class="line">    Long memberId = entity.getId();</span><br><span class="line">    log.info(<span class="string">"æ’å…¥çš„affectRow= [&#123;&#125;],ä¸»é”®[&#123;&#125;]"</span>, affectRow, memberId);</span><br><span class="line">    <span class="keyword">if</span> (memberId != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"æ•…æ„æŠ›å‡ºå¼‚å¸¸"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    applicationEventPublisher.publishEvent(<span class="keyword">new</span> ThreeUserRegisterEvent(<span class="keyword">this</span>, memberId, phone));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®ï¼Œå®ç° <code>register()</code> äº‹åŠ¡æäº¤ä¹‹åï¼Œå†å‘å¸ƒäº‹ä»¶è¿˜æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ä½¿ç”¨äº‹åŠ¡æ¨¡æ¿TransactionTemplate</li>
</ul>
<ol>
<li>ä½¿ç”¨ä¹‹å‰éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®äº‹åŠ¡æ¨¡æ¿</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½® transactionTemplate --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åœ¨ä»£ç ä¸­ä½¿ç”¨äº‹åŠ¡æ¨¡æ¿æäº¤äº‹åŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">register</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€ ... æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">        log.info(<span class="string">"[çº¿ç¨‹name=&#123;&#125;,register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]"</span>, Thread.currentThread().getName(), phone);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€ ä¿å­˜ç”¨æˆ·(å‡è®¾è¿™æ˜¯)</span></span><br><span class="line">        Long memberId = transactionTemplate.execute(status -&gt; &#123;</span><br><span class="line">            Long result = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                BizLocalMessageEntity entity = <span class="keyword">new</span> BizLocalMessageEntity();</span><br><span class="line">                ThreadLocalRandom random = ThreadLocalRandom.current();</span><br><span class="line">                entity.setBizModule((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">                entity.setBizNo(<span class="string">""</span> + random.nextInt(<span class="number">200000</span>));</span><br><span class="line">                entity.setBizType((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">                entity.setMsg(<span class="string">"æ¶ˆæ¯å†…å®¹"</span>);</span><br><span class="line">                entity.setMsgDesc(<span class="string">"æ¶ˆæ¯å¤‡æ³¨"</span>);</span><br><span class="line">                entity.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">                entity.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> affectRow = bizLocalMessageMapper.insert(entity);</span><br><span class="line">                result = entity.getId();</span><br><span class="line">                log.info(<span class="string">"Version5 æ’å…¥çš„affectRow= [&#123;&#125;],ä¸»é”®[&#123;&#125;]"</span>, affectRow, result);</span><br><span class="line">                <span class="keyword">if</span> (affectRow &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//throw new RuntimeException("æµ‹è¯•ä¸»è¦ä¸šåŠ¡å¤±è´¥ï¼Œäº‹ä»¶æ˜¯å¦ä¼šå‘å¸ƒæ‰§è¡Œ");</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">"ä¸šåŠ¡å¤±è´¥å‘ç”Ÿå¼‚å¸¸"</span>, e);</span><br><span class="line">                <span class="comment">// æ ‡è®°äº‹åŠ¡å›æ»š</span></span><br><span class="line">                status.setRollbackOnly();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"äº‹åŠ¡æ‰§è¡Œæƒ…å†µ ç”¨æˆ·çš„id= [&#123;&#125;]"</span>, memberId);</span><br><span class="line">        <span class="keyword">if</span> (memberId != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 3ã€å¼‚æ­¥å‘å¸ƒäº‹ä»¶é€šçŸ¥</span></span><br><span class="line">            log.info(<span class="string">"å‘å¸ƒæ³¨å†ŒæˆåŠŸäº‹ä»¶"</span>);</span><br><span class="line">            applicationEventPublisher.publishEvent(<span class="keyword">new</span> UserRegisterEvent(<span class="keyword">this</span>, memberId, phone));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨TransactionSynchronizationManager</li>
</ul>
<p>è¿™ä¸ªå¯ä»¥ç›´æ¥ä½¿ç”¨æ— éœ€é…ç½®ï¼Œé‡å†™TransactionSynchronizationAdapterçš„afterCommit()æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span>(rollbackFor = Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">Result</span> <span class="title">register</span>(<span class="title">String</span> <span class="title">phone</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1ã€ ... æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">    log.info(<span class="string">"[Version4 register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]"</span>, phone);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ã€ ä¿å­˜ç”¨æˆ·(å‡è®¾è¿™æ˜¯)</span></span><br><span class="line">    BizLocalMessageEntity entity = <span class="keyword">new</span> BizLocalMessageEntity();</span><br><span class="line">    ThreadLocalRandom random = ThreadLocalRandom.current();</span><br><span class="line">    entity.setBizModule((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">    entity.setBizNo(<span class="string">""</span> + random.nextInt(<span class="number">100000</span>));</span><br><span class="line">    entity.setBizType((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">    entity.setMsg(<span class="string">""</span>);</span><br><span class="line">    entity.setMsgDesc(<span class="string">""</span>);</span><br><span class="line">    entity.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">    entity.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">    Long memberId = entity.getId();</span><br><span class="line">    <span class="keyword">int</span> affectRow = bizLocalMessageMapper.insert(entity);</span><br><span class="line">    log.info(<span class="string">"Version4 æ’å…¥çš„affectRow= [&#123;&#125;],ä¸»é”®[&#123;&#125;]"</span>, affectRow, memberId);</span><br><span class="line">    <span class="keyword">if</span> (affectRow &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//throw new RuntimeException("Version4 æµ‹è¯•ä¸»è¦ä¸šåŠ¡å¤±è´¥ï¼Œäº‹ä»¶æ˜¯å¦ä¼šå‘å¸ƒæ‰§è¡Œ");</span></span><br><span class="line">    &#125;</span><br><span class="line">    TransactionSynchronizationManager.registerSynchronization(<span class="keyword">new</span> TransactionSynchronizationAdapter() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCommit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.afterCommit();</span><br><span class="line">            <span class="comment">// 3ã€äº‹åŠ¡æäº¤ä¹‹åå‘å¸ƒäº‹ä»¶é€šçŸ¥</span></span><br><span class="line">            applicationEventPublisher.publishEvent(<span class="keyword">new</span> UserRegisterEvent(<span class="keyword">this</span>, memberId, phone));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Result();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŠŠç›®å‰çš„ä»£ç æ‰§è¡Œä¸€ä¸‹çœ‹çœ‹æƒ…å†µæ€ä¹ˆæ ·</p>
<img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204214744.png" style="zoom:50%;" alt="æ‰§è¡Œæ—¥å¿—æˆªå›¾"/>


<p>ä»æˆªå›¾ä¸Šçœ‹ï¼Œæˆ‘ä»¬ç›®å‰å·²ç»é€šè¿‡å¥½å‡ ç§æ–¹å¼è§£å†³äº†è§‚å¯Ÿè€…æ‰§è¡Œå¼‚å¸¸å¯¼è‡´äº‹åŠ¡å›æ»šçš„é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä»æˆªå›¾ä¸­çœ‹å‡ºç”¨æˆ·æ³¨å†Œé€»è¾‘å’Œå¯¹åº”çš„è§‚å¯Ÿè€…éƒ½æ˜¯åœ¨mainçº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è®©è§‚å¯Ÿè€…å¼‚æ­¥æ‰§è¡Œå—ï¼Ÿè¿™æ ·ä¹Ÿå¯ä»¥åŠ å¿«ä»£ç çš„æ‰§è¡Œé€Ÿåº¦ã€‚è¿™ä¸ªé—®é¢˜å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥è§£å†³çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ç›´æ¥ä½¿ç”¨@Asyncæ³¨è§£</li>
</ul>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼Œä½¿ç”¨è¿™ä¸ªæ³¨è§£ä¸€å®šè¦è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œä¸æ˜¯å®ƒé»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>org.springframework.core.task.SimpleAsyncTaskExecutor</code> ã€‚ä½†è¿™ä¸ª SimpleAsyncTaskExecutor ä¸æ˜¯çœŸçš„çº¿ç¨‹æ± ï¼Œè¿™ä¸ªç±»ä¸é‡ç”¨çº¿ç¨‹ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SixCouponService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="meta">@Order</span>(<span class="number">20</span>)</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCoupon</span><span class="params">(SixUserRegisterEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"æµ‹è¯•äº‹ä»¶ä¸­å‘ç”Ÿå¼‚å¸¸å¯¹åŸæœ‰ä¸šåŠ¡çš„å½±å“"</span>, <span class="string">""</span>);</span><br><span class="line">        Long memberId = event.getMemberId();</span><br><span class="line">        log.info(<span class="string">"çº¿ç¨‹name=&#123;&#125;,[addCoupon][ç»™ç”¨æˆ·(&#123;&#125;) å‘æ”¾ä¼˜æƒ åŠµ]"</span>, Thread.currentThread().getName(), memberId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨å¼‚æ­¥çº¿ç¨‹æ¥å‘å¸ƒäº‹ä»¶</li>
</ul>
<p>æ„æ€å°±æ˜¯äº‹åŠ¡æäº¤ä¹‹åï¼Œåˆ¤æ–­äº‹åŠ¡æäº¤æˆåŠŸåˆ™æ–°å»ºä¸€ä¸ªçº¿ç¨‹ç„¶åå‘å¸ƒæ³¨å†ŒæˆåŠŸäº‹ä»¶ã€‚äº‹åŠ¡æäº¤æˆåŠŸå¯ä»¥å‰é¢æåˆ°çš„äº‹åŠ¡æ¨¡æ¿transactionTemplateå’Œäº‹åŠ¡ç®¡ç†å™¨TransactionSynchronizationManagerã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Result <span class="title">register</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€ ... æ‰§è¡Œæ³¨å†Œé€»è¾‘</span></span><br><span class="line">        log.info(<span class="string">"[çº¿ç¨‹name=&#123;&#125;,register][æ‰§è¡Œç”¨æˆ·(&#123;&#125;) çš„æ³¨å†Œé€»è¾‘]"</span>, Thread.currentThread().getName(), phone);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€ ä¿å­˜ç”¨æˆ·(å‡è®¾è¿™æ˜¯)</span></span><br><span class="line">        Long memberId = transactionTemplate.execute(status -&gt; &#123;</span><br><span class="line">            Long result = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                BizLocalMessageEntity entity = <span class="keyword">new</span> BizLocalMessageEntity();</span><br><span class="line">                ThreadLocalRandom random = ThreadLocalRandom.current();</span><br><span class="line">                entity.setBizModule((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">                entity.setBizNo(<span class="string">""</span> + random.nextInt(<span class="number">200000</span>));</span><br><span class="line">                entity.setBizType((<span class="keyword">byte</span>) <span class="number">0</span>);</span><br><span class="line">                entity.setMsg(<span class="string">"æ¶ˆæ¯å†…å®¹"</span>);</span><br><span class="line">                entity.setMsgDesc(<span class="string">"æ¶ˆæ¯å¤‡æ³¨"</span>);</span><br><span class="line">                entity.setCreateTime(<span class="keyword">new</span> Date());</span><br><span class="line">                entity.setUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> affectRow = bizLocalMessageMapper.insert(entity);</span><br><span class="line">                result = entity.getId();</span><br><span class="line">                log.info(<span class="string">"Version5 æ’å…¥çš„affectRow= [&#123;&#125;],ä¸»é”®[&#123;&#125;]"</span>, affectRow, result);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">"ä¸šåŠ¡å¤±è´¥å‘ç”Ÿå¼‚å¸¸"</span>, e);</span><br><span class="line">                <span class="comment">// æ ‡è®°äº‹åŠ¡å›æ»š</span></span><br><span class="line">                status.setRollbackOnly();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"äº‹åŠ¡æ‰§è¡Œæƒ…å†µ ç”¨æˆ·çš„id= [&#123;&#125;]"</span>, memberId);</span><br><span class="line">        <span class="keyword">if</span> (memberId != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 3ã€å¼‚æ­¥å‘å¸ƒäº‹ä»¶é€šçŸ¥</span></span><br><span class="line">            log.info(<span class="string">"å‘å¸ƒæ³¨å†ŒæˆåŠŸäº‹ä»¶"</span>);</span><br><span class="line">            CompletableFuture.runAsync(()-&gt;&#123;</span><br><span class="line">                applicationEventPublisher.publishEvent(<span class="keyword">new</span> SixUserRegisterEvent(<span class="keyword">this</span>, memberId, phone));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç ä¿®æ”¹ä¹‹åæ‰§è¡Œï¼Œè¿è¡Œæˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204222111.png" alt="è¿è¡Œæˆªå›¾"><br>æˆ‘ä»¬å¯ä»¥å‘ç°ä»£ç åˆ†åˆ«mainã€taskExecutor-1å’ŒtaskExecutor-2 ä¸‰ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ï¼Œå®Œç¾çš„è§£å†³äº†ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ä¹‹å‰çš„ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼š</p>
<img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230251.png" alt="ä¼˜åŒ–åçš„æ³¨å†Œæµç¨‹" style="zoom:35%;" />

<p>ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ä¹‹åçš„ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼š</p>
<img src="https://gitee.com/ydstudios/blogImage/raw/master/img/20210204230429.png" alt="ä¼˜åŒ–åçš„æ³¨å†Œæµç¨‹" style="zoom:30%;" />


<h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>ç”¨æˆ·æ•°æ®å†™å…¥æ•°æ®è¡¨æˆåŠŸï¼Œå‘å¸ƒæ³¨å†ŒæˆåŠŸäº‹ä»¶ï¼Œé€šçŸ¥ç›¸å…³çš„çŸ­ä¿¡ã€ä¼˜æƒ åˆ¸ã€ç§¯åˆ†æ¨¡å—ã€‚ç”¨è§‚å¯Ÿè€…æ¨¡å¼å®ç°ä¹‹åï¼Œæ³¨å†Œé€»è¾‘å’Œå…¶ä»–çš„é€»è¾‘åˆ†ç¦»å¼€ï¼Œå³ä½¿åç»­æ–°åŠ ä¸€ä¸ªé‚®ä»¶é€šçŸ¥æˆ–è€…å»æ‰ä¸€ä¸ªå‘é€ç§¯åˆ†çš„æ“ä½œ,åªæ˜¯ä¿®æ”¹äº†å¯¹åº”çš„ä»£ç é€»è¾‘ï¼Œä¸ç”¨å›æ»šæµ‹è¯•æ‰€æœ‰åœºæ™¯ã€‚è¿™ç¬¦åˆå¯¹ä¿®æ”¹å…³é—­å¯¹æ‰©å±•å¼€æ”¾çš„è§„åˆ™ï¼Œæœ‰æ•ˆçš„é™ä½äº†å„ä¸ªæ¨¡å—ä¹‹é—´è€¦åˆåº¦ï¼Œä½¿å¾—ä»£ç çš„å¯ç»´æŠ¤æ€§å¤§å¤§æé«˜ã€‚æœ‰äº›åŒå­¦å¯èƒ½ä¼šæŠ±æ€¨ï¼Œè‡ªå·±çš„é¡¹ç›®ç®€å•ç”¨ä¸åˆ°è¿™äº›çœ‹ä¼¼é«˜å¤§ä¸Šçš„è®¾è®¡æ¨¡å¼ï¼Œå…¶å®ä¸ç„¶ï¼Œä½ åªæ˜¯æ²¡æœ‰è®¤çœŸç ”ç©¶è‡ªå·±çš„é¡¹ç›®ï¼Œè¿˜æœ‰å°±æ˜¯å¯¹è‡ªå·±çš„å†™çš„ä»£ç æ²¡æœ‰å¤ªé«˜çš„è¦æ±‚ã€‚å¦‚æœä½ çœ‹åˆ°äº†æœ¬æ–‡ï¼Œè€Œä¸”çœ‹åˆ°æ­¤å¤„ï¼Œä½ å›æƒ³ä¸€ä¸‹ä½ æ‰€åšçš„é¡¹ç›®ï¼Œéš¾é“æ²¡æœ‰ä¸€ä¸ªä¸šåŠ¡åœºæ™¯æ»¡è¶³è§‚å¯Ÿè€…æ¨¡å¼æ¡ä»¶ä¹ˆï¼Ÿä½ æƒ³æƒ³æ˜¯ä¸æ˜¯ï¼</p>

      
    </div>
         
            <div>
  <ul class="post-copyright">
    <li class="post-copyright-author">
    <strong>ä½œè€…:  </strong>Sam</a>
    </li>
    <li><span>å‘å¸ƒæ—¶é—´: </span>2021-02-04 23:49:32</li>
    <li><span>æœ€åæ›´æ–°: </span>2021-02-06 17:07:26</li>
    <li class="post-copyright-link">
    <strong>æ–‡ç« é“¾æ¥:  </strong>
    <a href="/post/5b3d1989.html" target="_blank" title="è§£è€¦ç¥å™¨ä¹‹è§‚å¯Ÿè€…æ¨¡å¼">https://ydstudios.gitee.io/post/5b3d1989.html</a>
    </li>
    <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜:   </strong>
      æœ¬ç½‘æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–, 
      ç¦æ­¢æœªç»æˆæƒè½¬è½½ï¼Œè¿è€…ä¾æ³•è¿½ç©¶ç›¸å…³æ³•å¾‹è´£ä»»!
    </li>
  </ul>
<div>
         
    <footer class="article-footer">
      <a data-url="https://ydstudios.gitee.io/post/5b3d1989.html" data-id="ckwz3vrz2008rl0szf3puax8d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" rel="tag">è§‚å¯Ÿè€…æ¨¡å¼</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">è®¾è®¡æ¨¡å¼</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/post/9d74cc19.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer >> </strong>
      <div class="article-nav-title">
        
          åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆåˆ°åº•æœ‰å“ªäº›
        
      </div>
    </a>
  
  
    <a href="/post/cd1b2f51.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older << </strong>
      <div class="article-nav-title">èˆ¹æ–°ç‰ˆæœ¬çš„ç­–ç•¥æ¨¡å¼ï¼Œä½ ä¸€å®šæ²¡æœ‰è§è¿‡</div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Sam<br>
      <!--Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>-->
      <p>å¤‡æ¡ˆå·:<a href="http://www.miitbeian.gov.cn/" target="_blank" rel="nofollow">è‹ICPå¤‡17069935å·-1</a></p>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">é¦–é¡µ</a>
  
    <a href="/archives" class="mobile-nav-link">å½’æ¡£</a>
  
    <a href="/about" class="mobile-nav-link">å…³äº</a>
  
    <a href="/links" class="mobile-nav-link">å‹é“¾</a>
  
</nav>
    

<script src="https://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>